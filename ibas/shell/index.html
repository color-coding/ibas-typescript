<!DOCTYPE html>
<html>

<head>
    <title>ibas apps</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8" />
    <script type="text/javascript" src="../3rdparty/jquery.js"></script>
    <script type="text/javascript" src="../3rdparty/require.js"></script>
    <script type="text/javascript">
        // 显示消息
        let requireError = function (error) {
            console.error(error);
            let scripts = document.getElementsByTagName("script");
            console.debug("-------------------  error  --------------------");
            for (let index = 0; index < scripts.length; index++) {
                let script = scripts[index];
                if (script.src !== undefined && script.src !== null && script.src.length !== 0) {
                    console.debug("script: file %s", script.src);
                } else if (script.innerHTML !== undefined && script.innerHTML !== null && script.innerHTML.length !== 0) {
                    console.debug("script: content %s", script.innerHTML);
                }
            }
            console.debug("-------------------  error  --------------------");
            alert("应用加载失败，请联系管理员或尝试使用其他浏览器。");
        };
        let loadEntry = function () {
            // 加载ibas
            let require = requirejs.config({
                baseUrl: "./../../"
            });
            require(["ibas/index"], function (ibas) {
                // 加载成功，创建壳加载
                let sysRequire = ibas.requires.create({
                    baseUrl: "./../../"
                }, []);
                // 加载应用系统
                sysRequire(["ibas/bsbas/systems/index"], function () {
                    // 加载成功
                    let shellRequire = ibas.requires.create({
                        context: ibas.requires.naming("shell"),
                        baseUrl: ibas.url.normalize(".../../")
                    }, ["ibas/bsbas/systems"]);
                    shellRequire(["shell/index"], function (index) {
                    }, requireError);
                }, requireError);
            }, requireError);
        }
        let loadUI5 = function (url) {
            // 加载opopenui5库
            let domScript = document.createElement('script');
            domScript.src = url;
            domScript.setAttribute("id", "sap-ui-bootstrap");
            domScript.setAttribute("data-sap-ui-bindingSyntax", "complex");
            domScript.setAttribute("data-sap-ui-theme", "sap_belize");
            domScript.setAttribute("data-sap-ui-libs", "sap.m, sap.ui.layout, sap.tnt, sap.uxap ,sap.ui.table");
            domScript.setAttribute("data-sap-ui-preload", "async"); // 异步加载预加载库
            domScript.onload = domScript.onreadystatechange = function () {
                if (!this.readyState || 'loaded' === this.readyState || 'complete' === this.readyState) {
                    // openui5初始化完成，
                    sap.ui.getCore().attachInit(function () {
                        loadEntry();
                    });
                }
            }
            document.getElementsByTagName('head')[0].appendChild(domScript);
        }
        $.ajax({
            type: 'GET',
            url: document.location.href + "../../openui5/resources/sap-ui-version.json",
            success: function () {
                // 本地库存在，则加载本地
                loadUI5(document.location.href + "../../openui5/resources/sap-ui-core.js");
            },
            error: function () {
                // 本地库不存在，则加载远程
                loadUI5("https://openui5.hana.ondemand.com/resources/sap-ui-core.js");
            }
        });
    </script>
</head>

<body class="sapUiBody" id="content">
</body>

</html>